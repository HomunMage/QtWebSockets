<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Client</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="context-menu">
        <ul>
            <li id="add-node">Add Node</li>
            <li id="remove-node">Remove Node</li>
        </ul>
    </div>

    <script>
        var socket = new WebSocket('ws://localhost:8000');
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        var dragging = false;
        var offsetX, offsetY;
        var squareX = 50, squareY = 50, squareSize = 100;

        function resizeCanvas() {
            canvas.width = window.innerWidth - 4; // Subtract some pixels to avoid scrollbars
            canvas.height = window.innerHeight - 4; // Subtract some pixels to avoid scrollbars
            drawOnCanvas(squareX, squareY, squareSize, squareSize, "Start");
        }

        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('load', resizeCanvas);

        socket.onopen = function() {
            console.log('WebSocket connection opened');
        };

        socket.onmessage = function(event) {
            var command = event.data;
            if (command.startsWith('draw')) {
                var parts = command.split(' ');
                squareX = parseInt(parts[2]);
                squareY = parseInt(parts[3]);
                drawOnCanvas(squareX, squareY, squareSize, squareSize, parts.slice(6).join(' '));
            }
        };

        function drawOnCanvas(x, y, width, height, text) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'black';
            ctx.fillRect(x, y, width, height);
            ctx.fillStyle = 'white';
            ctx.fillText(text, x + 25, y + 60);
        }

        canvas.onmousedown = function(e) {
            var rect = canvas.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;

            if (offsetX >= squareX && offsetX <= squareX + squareSize && offsetY >= squareY && offsetY <= squareY + squareSize) {
                dragging = true;
                offsetX -= squareX;
                offsetY -= squareY;
            }
        };

        canvas.onmousemove = function(e) {
            if (dragging) {
                var rect = canvas.getBoundingClientRect();
                var x = e.clientX - rect.left - offsetX;
                var y = e.clientY - rect.top - offsetY;
                socket.send(`move ${x} ${y}`);
            }
        };

        canvas.onmouseup = function() {
            dragging = false;
        };

        canvas.onmouseleave = function() {
            dragging = false;
        };

        canvas.oncontextmenu = function(e) {
            e.preventDefault();
            showContextMenu(e.clientX, e.clientY);
        };

        function showContextMenu(x, y) {
            var menu = document.getElementById('context-menu');
            menu.style.left = `${x}px`;
            menu.style.top = `${y}px`;
            menu.style.display = 'block';
        }

        function hideContextMenu() {
            var menu = document.getElementById('context-menu');
            menu.style.display = 'none';
        }

        document.getElementById('add-node').onclick = function() {
            socket.send('add node');
            hideContextMenu();
        };

        document.getElementById('remove-node').onclick = function() {
            socket.send('remove node');
            hideContextMenu();
        };

        window.onclick = function() {
            hideContextMenu();
        };

        canvas.oncontextmenu = function(e) {
            e.preventDefault();
            var rect = canvas.getBoundingClientRect();
            var x = e.clientX - rect.left;
            var y = e.clientY - rect.top;

            var isNode = offsetX >= squareX && offsetX <= squareX + squareSize && offsetY >= squareY && offsetY <= squareY + squareSize;
            showContextMenu(e.clientX, e.clientY);
        };
    </script>
</body>
</html>
